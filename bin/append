#!/bin/bash

# append COMMAND	Capture output from stdin, pipe that through COMMAND,
#			and output that output afterwards, too.
#			Example: diff -u orig new | append diffstat -C
set -e

typeset -a ARGS=("$@")
TMPFILE=$(mktemp --tmpdir "$(basename -- "$0")-XXXXXX" 2>/dev/null || echo "${TEMP:-/tmp}/$(basename -- "$0").$$")
finally()
{
    if [ -s "$TMPFILE" ]; then
	cat "$TMPFILE" | eval "${ARGS[@]}"
    fi
    rm -f "$TMPFILE" 2>/dev/null
}
trap 'finally' INT TERM EXIT

tee "$TMPFILE"
