#!/bin/sed -f

# Condense subsequent #'s at the end of a line or if a $ sigil is following into a count.
#
# To make the following replacements easier, replace the literal $ / eol match
# with another unique marker.
s/#\(\$\|$\)/#/g

:tens
s/#\{10\}\(#*\)/\1/g
t tens
:hundreds
s/\{10\}\(*#*\)/\1/g
t hundreds
:thousands
s/\{10\}\(**#*\)/\1/g
t thousands

s/#\{9\}/9/g
s/#\{8\}/8/g
s/#\{7\}/7/g
s/#\{6\}/6/g
s/#\{5\}/5/g
s/#\{4\}/4/g
s/#\{3\}/3/g
s/#\{2\}/2/g
s/#\{1\}/1/g

s//0/g
s/\{9\}\([0-9]*\)/9\1/g
s/\{8\}\([0-9]*\)/8\1/g
s/\{7\}\([0-9]*\)/7\1/g
s/\{6\}\([0-9]*\)/6\1/g
s/\{5\}\([0-9]*\)/5\1/g
s/\{4\}\([0-9]*\)/4\1/g
s/\{3\}\([0-9]*\)/3\1/g
s/\{2\}\([0-9]*\)/2\1/g
s/\{1\}\([0-9]*\)/1\1/g

s//00/g
s/\([0-9]\)/0\1/g
s/\{9\}\([0-9]*\)/9\1/g
s/\{8\}\([0-9]*\)/8\1/g
s/\{7\}\([0-9]*\)/7\1/g
s/\{6\}\([0-9]*\)/6\1/g
s/\{5\}\([0-9]*\)/5\1/g
s/\{4\}\([0-9]*\)/4\1/g
s/\{3\}\([0-9]*\)/3\1/g
s/\{2\}\([0-9]*\)/2\1/g
s/\{1\}\([0-9]*\)/1\1/g

# Handle overflow, i.e. larger than 9999.
s/\{10,\}[0-9]*/10000+/g

s//000/g
s/\([0-9]\)/00\1/g
s/\([0-9][0-9]\)/0\1/g
s/\{9\}\([0-9]*\)/9\1/g
s/\{8\}\([0-9]*\)/8\1/g
s/\{7\}\([0-9]*\)/7\1/g
s/\{6\}\([0-9]*\)/6\1/g
s/\{5\}\([0-9]*\)/5\1/g
s/\{4\}\([0-9]*\)/4\1/g
s/\{3\}\([0-9]*\)/3\1/g
s/\{2\}\([0-9]*\)/2\1/g
s/\{1\}\([0-9]*\)/1\1/g

# Finally remove the unique marker.
s/\([0-9]\+\)/\1/g
