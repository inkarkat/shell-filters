#!/bin/sed -f

# Condense subsequent #'s at the end of a line or if a $ sigil is following into a count.
#
# To make the following replacements easier, replace the literal $ / eol match
# with another unique marker.
s/#\(\$\|$\)/#/

:tens
s/#\{10\}\(#*\)/\1/
t tens
:hundreds
s/\{10\}\(*#*\)/\1/
t hundreds
:thousands
s/\{10\}\(**#*\)/\1/
t thousands
s/#\{9\}/9/
s/#\{8\}/8/
s/#\{7\}/7/
s/#\{6\}/6/
s/#\{5\}/5/
s/#\{4\}/4/
s/#\{3\}/3/
s/#\{2\}/2/
s/#\{1\}/1/
s//0/
s/\{9\}\([0-9]*\)/9\1/
s/\{8\}\([0-9]*\)/8\1/
s/\{7\}\([0-9]*\)/7\1/
s/\{6\}\([0-9]*\)/6\1/
s/\{5\}\([0-9]*\)/5\1/
s/\{4\}\([0-9]*\)/4\1/
s/\{3\}\([0-9]*\)/3\1/
s/\{2\}\([0-9]*\)/2\1/
s/\{1\}\([0-9]*\)/1\1/
s//00/
s/\([0-9]\)/0\1/
s/\{9\}\([0-9]*\)/9\1/
s/\{8\}\([0-9]*\)/8\1/
s/\{7\}\([0-9]*\)/7\1/
s/\{6\}\([0-9]*\)/6\1/
s/\{5\}\([0-9]*\)/5\1/
s/\{4\}\([0-9]*\)/4\1/
s/\{3\}\([0-9]*\)/3\1/
s/\{2\}\([0-9]*\)/2\1/
s/\{1\}\([0-9]*\)/1\1/
s//000/
s/\([0-9]\)/00\1/
s/\([0-9][0-9]\)/0\1/
s/\{9\}\([0-9]*\)/9\1/
s/\{8\}\([0-9]*\)/8\1/
s/\{7\}\([0-9]*\)/7\1/
s/\{6\}\([0-9]*\)/6\1/
s/\{5\}\([0-9]*\)/5\1/
s/\{4\}\([0-9]*\)/4\1/
s/\{3\}\([0-9]*\)/3\1/
s/\{2\}\([0-9]*\)/2\1/
s/\{1\}\([0-9]*\)/1\1/
# Finally remove the unique marker.
s/\([0-9]\+\)/\1/
